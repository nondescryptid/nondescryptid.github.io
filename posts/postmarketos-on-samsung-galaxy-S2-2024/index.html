<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>My WiFi doesn't work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024 | nondescryptid</title><meta name=keywords content><meta name=description content="I&rsquo;ve got a Samsung Galaxy S II (i9100) lying around, and decided to try seeing if I can repurpose it and get it to host a blog. I was inspired by compost.party &ndash; a very cool server running off a Xiaomi Poco F1 using postmarketOS and a solar panel for charging.
The physical nature of computing is usually not a concern, as things are sufficiently abstracted for me to not have to care too much about it."><meta name=author content><link rel=canonical href=https://tomoe.asia/posts/postmarketos-on-samsung-galaxy-S2-2024/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://res.cloudinary.com/dezwnhp01/image/upload/v1690391047/pixeltree.png><link rel=icon type=image/png sizes=16x16 href=https://tomoe.asia/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomoe.asia/favicon-32x32.png><link rel=apple-touch-icon href=https://tomoe.asia/apple-touch-icon.png><link rel=mask-icon href=https://tomoe.asia/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="My WiFi doesn't work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024"><meta property="og:description" content="I&rsquo;ve got a Samsung Galaxy S II (i9100) lying around, and decided to try seeing if I can repurpose it and get it to host a blog. I was inspired by compost.party &ndash; a very cool server running off a Xiaomi Poco F1 using postmarketOS and a solar panel for charging.
The physical nature of computing is usually not a concern, as things are sufficiently abstracted for me to not have to care too much about it."><meta property="og:type" content="article"><meta property="og:url" content="https://tomoe.asia/posts/postmarketos-on-samsung-galaxy-S2-2024/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-16T15:04:44+08:00"><meta property="article:modified_time" content="2024-09-16T15:04:44+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="My WiFi doesn't work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024"><meta name=twitter:description content="I&rsquo;ve got a Samsung Galaxy S II (i9100) lying around, and decided to try seeing if I can repurpose it and get it to host a blog. I was inspired by compost.party &ndash; a very cool server running off a Xiaomi Poco F1 using postmarketOS and a solar panel for charging.
The physical nature of computing is usually not a concern, as things are sufficiently abstracted for me to not have to care too much about it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://tomoe.asia/posts/"},{"@type":"ListItem","position":3,"name":"My WiFi doesn't work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024","item":"https://tomoe.asia/posts/postmarketos-on-samsung-galaxy-S2-2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"My WiFi doesn't work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024","name":"My WiFi doesn\u0027t work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024","description":"I\u0026rsquo;ve got a Samsung Galaxy S II (i9100) lying around, and decided to try seeing if I can repurpose it and get it to host a blog. I was inspired by compost.party \u0026ndash; a very cool server running off a Xiaomi Poco F1 using postmarketOS and a solar panel for charging.\nThe physical nature of computing is usually not a concern, as things are sufficiently abstracted for me to not have to care too much about it.","keywords":[],"articleBody":"I’ve got a Samsung Galaxy S II (i9100) lying around, and decided to try seeing if I can repurpose it and get it to host a blog. I was inspired by compost.party – a very cool server running off a Xiaomi Poco F1 using postmarketOS and a solar panel for charging.\nThe physical nature of computing is usually not a concern, as things are sufficiently abstracted for me to not have to care too much about it. But trying to revive this phone from 2011 was a reminder that when we talk about compute, we are ultimately dealing with physical resources – tiny towns with blocks of silicon, lithium, etc etc.\nThis post will also talk more about the tools I found helpful in troubleshooting - I wasn’t familiar with things like dmesg, logread, rfkill, ip, iw or grep before this, but this gave me a lot of practice.\nI’ve ended up killing this project (for now) because of issues with sourcing batteries (more on this later) and my lack of expertise in debugging problems with kernels and firmware, so this is sort of a journal entry/obituary for my i9100 and everything it’s gone through so far.\nInstalling postmarketOS (pmOS) pmOS can be installed with a tool called pmbootstrap or via a pre-built image for your device (check if your device is on the list).\nThings to note when using pmbootstrap for the i9100 There is no pre-built image for the I9100, so you’ll need to create the image and install it with pmbootstrap (postmarketOS build tool). This requires an unlocked bootloader, but the I9100 bootloader is already unlocked so you don’t need to do anything on your part. You will need Linux to use pmbootstrap. Fortunately, I’ve got an old Macbook Pro (A1278) running Ubuntu 22.04. You should use v3 of pmbootstrap for the i9100. The wiki page for installation will encourage you to use the stable release, but you should ignore it. There is an issue (“i9100 Flashing mainline kernel fails with missing vmlinuz-dtb”) with previous versions of pmbootstrap that affects the i9100 and a few other phones that use a method of flashing called iso-rec. Installing pmbootstrap from git Follow the instructions here for installation via git. Ignore the part where it encourages you to use the stable release. Make sure that when you check pmbootstrap --version that it starts with 3.\nConfiguring your OS image pmbootstrap init and building the OS image Run pmbootstrap init. There will be a series of questions for configuration.\nOne of the earliest prompts concerns which release channel you want to use.My experience regarding edge vs stable release channels: When configuring your pmOS installation, choosing the edge release channel may result in a lack of wifi scanning functionality. I tried edge on 21 Sep 2024 and it led to my wlan0 appearing to be up, but was unable to scan for wifi networks. After trying the latest stable release channel v24.06, I was able to use wifi scanning.\nWhen prompted for vendor, type samsung and when asked for your device’s codename, say i9100. You can go with the default options for everything else.\nAfter you’re done with configuring, use pmbootstrap install. This will build the image for your phone based on the information you’ve provided.\nInstalling postmarketOS on your phone I won’t belabour the point here - refer to Instructions from the postmarketOS wiki for the Samsung Galaxy S II.\nThe phone will reboot in between flash_rootfs and flash_kernel. If it seems to be stuck in a boot loop after flash_rootfs, you can shut it off by just removing the battery and trying to enter ODIN/download mode again to do flash_kernel. After this, you should be able to use postmarketOS.\nAfter booting: Enabling SSH and sharing internet with your phone over USB (since WiFi doesn’t work yet) At this point, WiFi does not work.\nTo get started, I connected my phone to my laptop with a microUSB cable and connected via ssh so I could at least use the terminal with a proper keyboard (the on-screen keyboard is a bit small).\nIf you kept the default username (user) in pmbootstrap init, you can connect with ssh user@172.16.42.1 and then enter your password.\nThe long-drawn struggle with WiFi Debugging problems with WiFi The strange thing was that the WiFi screen in the Settings app on the phone wouldn’t display any networks, but Bluetooth was working. WiFi and Bluetooth functionality are handled by the Broadcom BCM4330 chip.\nTo get an idea what was going wrong, I tried running dmesg. This helps to review what’s happening as the system starts up.\nMe \u0026 my failed firmware load I ended up finding this:\n[ 18.099406] brcmfmac mmc2:0001:1: Direct firmware load for brcm/brcmfmac4330-sdio.samsung,i9100.bin failed with error -2 There were a lot of lines and this took a lot of scrolling, but if you’re in the future and trying to check if your firmware load failed – you can try something like dmesg | grep samsung which should narrow down your results compared to looking at the whole of dmesg.\nHowever, this was confusing because I didn’t know where exactly the firmware was being loaded from. After some searching, I found that the Linux kernel typically expects firmware to be found in /lib/firmware. In this case, it was looking for Broadcom firmware in /lib/firmware/brcm.\nAfter visiting that folder and listing its contents ($ ls /lib/firmware/brcm) I realised it was empty, and that the firmware files were actually in /lib/firmware/postmarketos/brcm.\nThe postmarketOS wiki’s WiFi page says:\nDevices with Broadcom WiFi chips usually have the path to the firmware hardcoded in the kernel, mostly to /system/vendor/firmware.\nIn most cases you should be able to set CONFIG_BCMDHD_FW_PATH and CONFIG_BCMDHD_NVRAM_PATH in the kernel config. In other cases, you need to patch the kernel and change the path to /lib/firmware/postmarketos (see this patch).\nAs someone who doesn’t know how to configure a kernel, or where to even find the config, or what “patch the kernel” means\" – I decided to just do the most straightforward thing I could think of:\nCopy the firmware files from the lib/firmware/postmarketos/brcm directory to the /lib/firmware/brcm directory: sudo cp -r /lib/firmware/postmarketos/brcm/* /lib/firmware/brcm/ Reboot with sudo reboot (though you could do this through the phone’s UI too) After doing this, the error message complaining about problems with loading brcm/brcmfmac4330-sdio.samsung,i9100.bin should go away.\nDoing various checks on the wlan0 interface After placating the kernel by putting the firmware at the location it was looking for it, I did the following checks:\nip a This is meant to show and list all ip addresses associated on network interfaces. I use it to check if the wlan0 interface even exists.\nHere’s what it looked for me:\nsamsung-i9100:~$ ip a 1: lo: mtu 65536 qdisc noqueue state UNKNOWN qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: usb0: mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 22:14:db:d6:a9:60 brd ff:ff:ff:ff:ff:ff inet 172.16.42.1/16 brd 172.16.255.255 scope global noprefixroute usb0 valid_lft forever preferred_lft forever inet6 fe80::6ab0:a1b4:35df:aac7/64 scope link noprefixroute valid_lft forever preferred_lft forever 3: wlan0: mtu 1500 qdisc pfifo_fast state DOWN qlen 1000 link/ether 14:7d:c5:eb:47:2b brd ff:ff:ff:ff:ff:ff wlan0: indicates that the interface is up.\nrfkill list This helps to check that wlan0 is not being blocked by software or hardware.\nsamsung-i9100:~$ rfkill list 0: phy0: Wireless LAN Soft blocked: no Hard blocked: no 1: wlan0: Wireless LAN Soft blocked: no Hard blocked: no If any of these interfaces are blocked, you can try sudo rfkill unblock all\nnmcli dev wifi list nmcli is a command line interface for NetworkManager. You can scan for wifi with nmcli dev wifi list. If it’s successful, it should show a list of networks near you.\niw reg get and iw reg set I didn’t face an issue with the regulatory region, but if problems still persist even if ip a and rfkill list return happy outputs, you can try checking your regulatory region with iw reg get and iw reg set $COUNTRY_CODE. The $COUNTRY_CODE is the 2 letter country code (ISO 3166-1 alpha-2). For instance, changing my regulatory region to Singapore would mean doing iw reg set SG.\nSharing my laptop’s internet connection with the phone Being able to share my laptop’s connection with my phone was helpful for experimenting with downloading some packages while troubleshooting. For instance, iw didn’t come with the default pmOS (since I did not specify any additional packages to install).\nFollow the instructions here: postmarketOS wiki: USB Internet\nOn the part of my phone, changing the nameserver with echo nameserver 1.1.1.1 \u003e /etc/resolv.conf as suggested on the wiki didn’t work even when I ran it with sudo as it kept saying I didn’t have permission to do that. However, using sudo vi /etc/resolv.conf and editing the file to change nameserver to nameserver 8.8.8.8 worked.\nAfter that I tested my connection with ping.\nAfter all that, my i9100 only connects to my iPhone’s hotspot and refuses to connect to anything else. Somehow, I’m able to connect to my iPhone’s hotspot while connecting to my home’s 2.4GHz and 5GHz networks which both use WPA2-AES has been a largely fruitless endeavour. I even tried various public WiFi networks by standing around outside Burger King and around various malls to no avail.\nWhen I try to connect to my home wifi with wpa_supplicant, I get all these complaints:\n[Sep 25 22:41:17] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110 [Sep 25 22:41:17] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110) [Sep 25 22:41:20] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110 [Sep 25 22:41:20] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110) [Sep 25 22:41:33] kern kernel: ieee80211 phy0: brcmf_run_escan: error (-110) [Sep 25 22:41:33] kern kernel: ieee80211 phy0: brcmf_cfg80211_scan: scan error (-110) [Sep 25 22:41:36] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110 [Sep 25 22:41:36] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110) [Sep 25 22:41:38] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110 [Sep 25 22:41:38] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110) I don’t even know where to start with debugging this.\nWhen I tried NetworkManager, it’d constantly say Connection activation failed: (7) Secrets were required, but not provided even though my password was correct. I thought there were no secrets between me and my Nokia Beacon 1, but I suppose it begs to differ. I tried every fix I could find regarding this issue. I even tried changing the channels that my network used to match my iPhone hotspot in some kind of desperate last-ditch attempt to make things right.\n(For checkling logs from these services, I used logread)\nDespite all my half-baked attempts to fix this problem, my phone still has only ever connected on one network – my iPhone hotspot. Some kind of strange, forbidden electronic monogamy between my Samsung Galaxy and iPhone. I declare them husband and WiFi.\nMy WiFi doesn’t work because there are ghosts in the machine and love in the air.\nPower struggle (it could be the battery, or perhaps the charging port, or both) I started having problems where I’d plug my charger in, then the phone would light up with an empty battery sign, and then go back to black. This would continue even as I left it plugged in for hours.\nI got a new battery at a shop at Sim Lim Square (Unicell on the 2nd floor) which worked for about a week, before it started having this problem too. I decided to try measuring the voltage on the battery and it came up to about 2.6V after 5 hours of charging.\nAfter leaving it overnight, I measured the voltage the next day and it came up to… 0.004V.\nWe’re totally back together\nUnicell gave me a replacement as I brought it back to the store within 30 days, and they verified that it really was unbelievably drained with their own multimeter. This was nice, as I got a bit loopy and started wondering if my multimeter was also broken.\nWe’re so over\nThe same problem appeared with the new battery. At this point, I feel like I’ve tried all I can think of and can’t seem to surmount the problems with powering this device and also getting it to connect to my home wifi (much less powering it with solar).\n","wordCount":"2063","inLanguage":"en","datePublished":"2024-09-16T15:04:44+08:00","dateModified":"2024-09-16T15:04:44+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomoe.asia/posts/postmarketos-on-samsung-galaxy-S2-2024/"},"publisher":{"@type":"Organization","name":"nondescryptid","logo":{"@type":"ImageObject","url":"https://res.cloudinary.com/dezwnhp01/image/upload/v1690391047/pixeltree.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomoe.asia accesskey=h title="nondescryptid (Alt + H)">nondescryptid</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tomoe.asia/ title=Home><span>Home</span></a></li><li><a href=https://tomoe.asia/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://tomoe.asia/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://tomoe.asia/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://tomoe.asia/lol title=LOL><span>LOL</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>My WiFi doesn't work because there are ghosts in the machine and magic in the batteries: postmarketOS on a Samsung Galaxy SII (i9100) in Sep 2024</h1><div class=post-meta><span title='2024-09-16 15:04:44 +0800 +0800'>September 16, 2024</span>&nbsp;·&nbsp;10 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#installing-postmarketos-pmos aria-label="Installing postmarketOS (pmOS)">Installing postmarketOS (pmOS)</a><ul><li><a href=#things-to-note-when-using-pmbootstrap-for-the-i9100 aria-label="Things to note when using pmbootstrap for the i9100">Things to note when using <code>pmbootstrap</code> for the i9100</a></li><li><a href=#installing-pmbootstrap-from-git aria-label="Installing pmbootstrap from git">Installing <code>pmbootstrap</code> from <code>git</code></a></li><li><a href=#configuring-your-os-image-pmbootstrap-init-and-building-the-os-image aria-label="Configuring your OS image pmbootstrap init and building the OS image">Configuring your OS image <code>pmbootstrap init</code> and building the OS image</a></li><li><a href=#installing-postmarketos-on-your-phone aria-label="Installing postmarketOS on your phone">Installing postmarketOS on your phone</a></li><li><a href=#after-booting-enabling-ssh-and-sharing-internet-with-your-phone-over-usb-since-wifi-doesnt-work-yet aria-label="After booting: Enabling SSH and sharing internet with your phone over USB (since WiFi doesn&amp;rsquo;t work yet)">After booting: Enabling SSH and sharing internet with your phone over USB (since WiFi doesn&rsquo;t work yet)</a></li></ul></li><li><a href=#the-long-drawn-struggle-with-wifi aria-label="The long-drawn struggle with WiFi">The long-drawn struggle with WiFi</a><ul><li><a href=#debugging-problems-with-wifi aria-label="Debugging problems with WiFi">Debugging problems with WiFi</a><ul><li><a href=#me--my-failed-firmware-load aria-label="Me &amp;amp; my failed firmware load">Me & my failed firmware load</a></li><li><a href=#doing-various-checks-on-the-wlan0-interface aria-label="Doing various checks on the wlan0 interface">Doing various checks on the <code>wlan0</code> interface</a><ul><li><a href=#ip-a aria-label="ip a"><code>ip a</code></a></li><li><a href=#rfkill-list aria-label="rfkill list"><code>rfkill list</code></a></li><li><a href=#nmcli-dev-wifi-list aria-label="nmcli dev wifi list"><code>nmcli dev wifi list</code></a></li><li><a href=#iw-reg-get-and-iw-reg-set aria-label="iw reg get and iw reg set"><code>iw reg get</code> and <code>iw reg set</code></a></li></ul></li></ul></li><li><a href=#sharing-my-laptops-internet-connection-with-the-phone aria-label="Sharing my laptop&amp;rsquo;s internet connection with the phone">Sharing my laptop&rsquo;s internet connection with the phone</a></li><li><a href=#after-all-that-my-i9100-only-connects-to-my-iphones-hotspot-and-refuses-to-connect-to-anything-else aria-label="After all that, my i9100 only connects to my iPhone&amp;rsquo;s hotspot and refuses to connect to anything else.">After all that, my i9100 only connects to my iPhone&rsquo;s hotspot and refuses to connect to anything else.</a></li></ul></li><li><a href=#power-struggle-it-could-be-the-battery-or-perhaps-the-charging-port-or-both aria-label="Power struggle (it could be the battery, or perhaps the charging port, or both)">Power struggle (it could be the battery, or perhaps the charging port, or both)</a></li></ul></div></details></div><div class=post-content><p>I&rsquo;ve got a Samsung Galaxy S II (i9100) lying around, and decided to try seeing if I can repurpose it and get it to host a blog. I was inspired by <a href=https://compost.party>compost.party</a> &ndash; a very cool server running off a Xiaomi Poco F1 using postmarketOS and a solar panel for charging.</p><p>The physical nature of computing is usually not a concern, as things are sufficiently abstracted for me to not have to care too much about it. But trying to revive this phone from 2011 was a reminder that when we talk about compute, we are ultimately dealing with physical resources &ndash; tiny towns with blocks of silicon, lithium, etc etc.</p><p>This post will also talk more about the tools I found helpful in troubleshooting - I wasn&rsquo;t familiar with things like <code>dmesg</code>, <code>logread</code>, <code>rfkill</code>, <code>ip</code>, <code>iw</code> or <code>grep</code> before this, but this gave me a lot of practice.</p><p>I&rsquo;ve ended up killing this project (for now) because of issues with sourcing batteries (more on this later) and my lack of expertise in debugging problems with kernels and firmware, so this is sort of a journal entry/obituary for my i9100 and everything it&rsquo;s gone through so far.</p><h1 id=installing-postmarketos-pmos>Installing postmarketOS (pmOS)<a hidden class=anchor aria-hidden=true href=#installing-postmarketos-pmos>#</a></h1><p>pmOS can be installed with a tool called <code>pmbootstrap</code> or via a pre-built image for your device (<a href=https://postmarketos.org/install/>check if your device is on the list</a>).</p><h2 id=things-to-note-when-using-pmbootstrap-for-the-i9100>Things to note when using <code>pmbootstrap</code> for the i9100<a hidden class=anchor aria-hidden=true href=#things-to-note-when-using-pmbootstrap-for-the-i9100>#</a></h2><ol><li>There is no pre-built image for the I9100, so you&rsquo;ll need to create the image and install it with <code>pmbootstrap</code> (postmarketOS build tool).</li><li>This requires an unlocked bootloader, but the I9100 bootloader is already unlocked so you don&rsquo;t need to do anything on your part.</li><li>You will need Linux to use <code>pmbootstrap</code>. Fortunately, I&rsquo;ve got an old Macbook Pro (A1278) running Ubuntu 22.04.</li><li>You should use v3 of <code>pmbootstrap</code> for the i9100. The wiki page for installation will encourage you to use the stable release, but you should ignore it. There is an issue (<a href=https://gitlab.com/postmarketOS/pmaports/-/issues/2735>&ldquo;i9100 Flashing mainline kernel fails with missing vmlinuz-dtb&rdquo;</a>) with previous versions of <code>pmbootstrap</code> that affects the i9100 and a few other phones that use a method of flashing called <code>iso-rec</code>.</li></ol><h2 id=installing-pmbootstrap-from-git>Installing <code>pmbootstrap</code> from <code>git</code><a hidden class=anchor aria-hidden=true href=#installing-pmbootstrap-from-git>#</a></h2><p>Follow the instructions <a href=https://wiki.postmarketos.org/wiki/Pmbootstrap#From_git>here</a> for installation via git. Ignore the part where it encourages you to use the stable release. Make sure that when you check <code>pmbootstrap --version</code> that it starts with 3.</p><h2 id=configuring-your-os-image-pmbootstrap-init-and-building-the-os-image>Configuring your OS image <code>pmbootstrap init</code> and building the OS image<a hidden class=anchor aria-hidden=true href=#configuring-your-os-image-pmbootstrap-init-and-building-the-os-image>#</a></h2><p>Run <code>pmbootstrap init</code>. There will be a series of questions for configuration.</p><p>One of the earliest prompts concerns which release channel you want to use.My experience regarding <code>edge</code> vs <code>stable</code> release channels: When configuring your pmOS installation, choosing the <code>edge</code> release channel may result in a lack of wifi scanning functionality. I tried <code>edge</code> on 21 Sep 2024 and it led to my <code>wlan0</code> appearing to be up, but was unable to scan for wifi networks. After trying the latest stable release channel <code>v24.06</code>, I was able to use wifi scanning.</p><p>When prompted for <code>vendor</code>, type <code>samsung</code> and when asked for your device&rsquo;s codename, say <code>i9100</code>. You can go with the default options for everything else.</p><p>After you&rsquo;re done with configuring, use <code>pmbootstrap install</code>. This will build the image for your phone based on the information you&rsquo;ve provided.</p><h2 id=installing-postmarketos-on-your-phone>Installing postmarketOS on your phone<a hidden class=anchor aria-hidden=true href=#installing-postmarketos-on-your-phone>#</a></h2><p>I won&rsquo;t belabour the point here - refer to <a href=https://wiki.postmarketos.org/wiki/Samsung_Galaxy_SII_(samsung-i9100)/Installation>Instructions from the postmarketOS wiki for the Samsung Galaxy S II</a>.</p><p>The phone will reboot in between <code>flash_rootfs</code> and <code>flash_kernel</code>. If it seems to be stuck in a boot loop after <code>flash_rootfs</code>, you can shut it off by just removing the battery and trying to enter ODIN/download mode again to do <code>flash_kernel</code>. After this, you should be able to use postmarketOS.</p><h2 id=after-booting-enabling-ssh-and-sharing-internet-with-your-phone-over-usb-since-wifi-doesnt-work-yet>After booting: Enabling SSH and sharing internet with your phone over USB (since WiFi doesn&rsquo;t work yet)<a hidden class=anchor aria-hidden=true href=#after-booting-enabling-ssh-and-sharing-internet-with-your-phone-over-usb-since-wifi-doesnt-work-yet>#</a></h2><p>At this point, WiFi does not work.</p><p>To get started, I connected my phone to my laptop with a microUSB cable and connected via <code>ssh</code> so I could at least use the terminal with a proper keyboard (the on-screen keyboard is a bit small).</p><p>If you kept the default username (<code>user</code>) in <code>pmbootstrap init</code>, you can connect with <code>ssh user@172.16.42.1</code> and then enter your password.</p><h1 id=the-long-drawn-struggle-with-wifi>The long-drawn struggle with WiFi<a hidden class=anchor aria-hidden=true href=#the-long-drawn-struggle-with-wifi>#</a></h1><h2 id=debugging-problems-with-wifi>Debugging problems with WiFi<a hidden class=anchor aria-hidden=true href=#debugging-problems-with-wifi>#</a></h2><p>The strange thing was that the WiFi screen in the Settings app on the phone wouldn&rsquo;t display any networks, but Bluetooth was working. WiFi and Bluetooth functionality are handled by the Broadcom BCM4330 chip.</p><p>To get an idea what was going wrong, I tried running <code>dmesg</code>. This helps to review what&rsquo;s happening as the system starts up.</p><h3 id=me--my-failed-firmware-load>Me & my failed firmware load<a hidden class=anchor aria-hidden=true href=#me--my-failed-firmware-load>#</a></h3><p>I ended up finding this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>
</span></span><span style=display:flex><span>[   18.099406] brcmfmac mmc2:0001:1: Direct firmware load for brcm/brcmfmac4330-sdio.samsung,i9100.bin failed with error -2
</span></span></code></pre></div><p>There were a lot of lines and this took a lot of scrolling, but if you&rsquo;re in the future and trying to check if your firmware load failed &ndash; you can try something like <code>dmesg | grep samsung</code> which should narrow down your results compared to looking at the whole of <code>dmesg</code>.</p><p>However, this was confusing because I didn&rsquo;t know where exactly the firmware was being loaded from. After some searching, I found that the Linux kernel typically expects firmware to be found in <a href=https://www.linuxfromscratch.org/blfs/view/svn/postlfs/firmware.html><code>/lib/firmware</code></a>. In this case, it was looking for Broadcom firmware in <code>/lib/firmware/brcm</code>.</p><p>After visiting that folder and listing its contents (<code>$ ls /lib/firmware/brcm</code>) I realised it was empty, and that the firmware files were actually in <code>/lib/firmware/postmarketos/brcm</code>.</p><p>The <a href=https://wiki.postmarketos.org/wiki/WiFi>postmarketOS wiki&rsquo;s WiFi page</a> says:</p><blockquote><p>Devices with Broadcom WiFi chips usually have the path to the firmware hardcoded in the kernel, mostly to /system/vendor/firmware.</p><p>In most cases you should be able to set CONFIG_BCMDHD_FW_PATH and CONFIG_BCMDHD_NVRAM_PATH in the kernel config. In other cases, you need to patch the kernel and change the path to /lib/firmware/postmarketos (see this patch).</p></blockquote><p>As someone who doesn&rsquo;t know how to configure a kernel, or where to even find the config, or what &ldquo;patch the kernel&rdquo; means" &ndash; I decided to just do the most straightforward thing I could think of:</p><ol><li>Copy the firmware files from the <code>lib/firmware/postmarketos/brcm</code> directory to the <code>/lib/firmware/brcm</code> directory:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp -r /lib/firmware/postmarketos/brcm/* /lib/firmware/brcm/
</span></span></code></pre></div><ol start=2><li>Reboot with <code>sudo reboot</code> (though you could do this through the phone&rsquo;s UI too)</li></ol><p>After doing this, the error message complaining about problems with loading <code>brcm/brcmfmac4330-sdio.samsung,i9100.bin</code> should go away.</p><h3 id=doing-various-checks-on-the-wlan0-interface>Doing various checks on the <code>wlan0</code> interface<a hidden class=anchor aria-hidden=true href=#doing-various-checks-on-the-wlan0-interface>#</a></h3><p>After placating the kernel by putting the firmware at the location it was looking for it, I did the following checks:</p><h4 id=ip-a><code>ip a</code><a hidden class=anchor aria-hidden=true href=#ip-a>#</a></h4><p>This is meant to show and list all ip addresses associated on network interfaces. I use it to check if the <code>wlan0</code> interface even exists.</p><p>Here&rsquo;s what it looked for me:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>samsung-i9100:~$ ip a
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>65536</span> qdisc noqueue state UNKNOWN qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 ::1/128 scope host 
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>2: usb0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc pfifo_fast state UP qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 22:14:db:d6:a9:60 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 172.16.42.1/16 brd 172.16.255.255 scope global noprefixroute usb0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::6ab0:a1b4:35df:aac7/64 scope link noprefixroute 
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>3: wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc pfifo_fast state DOWN qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    link/ether 14:7d:c5:eb:47:2b brd ff:ff:ff:ff:ff:ff
</span></span></code></pre></div><p><code>wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP></code> indicates that the interface is up.</p><h4 id=rfkill-list><code>rfkill list</code><a hidden class=anchor aria-hidden=true href=#rfkill-list>#</a></h4><p>This helps to check that <code>wlan0</code> is not being blocked by software or hardware.</p><pre tabindex=0><code>samsung-i9100:~$ rfkill list
0: phy0: Wireless LAN
	Soft blocked: no
	Hard blocked: no
1: wlan0: Wireless LAN
	Soft blocked: no
	Hard blocked: no
</code></pre><p>If any of these interfaces are blocked, you can try <code>sudo rfkill unblock all</code></p><h4 id=nmcli-dev-wifi-list><code>nmcli dev wifi list</code><a hidden class=anchor aria-hidden=true href=#nmcli-dev-wifi-list>#</a></h4><p><code>nmcli</code> is a command line interface for NetworkManager. You can scan for wifi with <code>nmcli dev wifi list</code>. If it&rsquo;s successful, it should show a list of networks near you.</p><h4 id=iw-reg-get-and-iw-reg-set><code>iw reg get</code> and <code>iw reg set</code><a hidden class=anchor aria-hidden=true href=#iw-reg-get-and-iw-reg-set>#</a></h4><p>I didn&rsquo;t face an issue with the regulatory region, but if problems still persist even if <code>ip a</code> and <code>rfkill list</code> return happy outputs, you can try checking your regulatory region with <code>iw reg get</code> and <code>iw reg set $COUNTRY_CODE</code>. The <code>$COUNTRY_CODE</code> is the 2 letter country code (<a href=https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2>ISO 3166-1 alpha-2</a>). For instance, changing my regulatory region to Singapore would mean doing <code>iw reg set SG</code>.</p><h2 id=sharing-my-laptops-internet-connection-with-the-phone>Sharing my laptop&rsquo;s internet connection with the phone<a hidden class=anchor aria-hidden=true href=#sharing-my-laptops-internet-connection-with-the-phone>#</a></h2><p>Being able to share my laptop&rsquo;s connection with my phone was helpful for experimenting with downloading some packages while troubleshooting. For instance, <code>iw</code> didn&rsquo;t come with the default pmOS (since I did not specify any additional packages to install).</p><p>Follow the instructions here: <a href=https://wiki.postmarketos.org/wiki/USB_Internet>postmarketOS wiki: USB Internet</a></p><p>On the part of my phone, changing the nameserver with <code>echo nameserver 1.1.1.1 > /etc/resolv.conf</code> as suggested on the wiki didn&rsquo;t work even when I ran it with <code>sudo</code> as it kept saying I didn&rsquo;t have permission to do that. However, using <code>sudo vi /etc/resolv.conf</code> and editing the file to change <code>nameserver</code> to <code>nameserver 8.8.8.8</code> worked.</p><p>After that I tested my connection with <code>ping</code>.</p><h2 id=after-all-that-my-i9100-only-connects-to-my-iphones-hotspot-and-refuses-to-connect-to-anything-else>After all that, my i9100 only connects to my iPhone&rsquo;s hotspot and refuses to connect to anything else.<a hidden class=anchor aria-hidden=true href=#after-all-that-my-i9100-only-connects-to-my-iphones-hotspot-and-refuses-to-connect-to-anything-else>#</a></h2><p>Somehow, I&rsquo;m able to connect to my iPhone&rsquo;s hotspot while connecting to my home&rsquo;s 2.4GHz and 5GHz networks which both use WPA2-AES has been a largely fruitless endeavour. I even tried various public WiFi networks by standing around outside Burger King and around various malls to no avail.</p><p>When I try to connect to my home wifi with <code>wpa_supplicant</code>, I get all these complaints:</p><pre tabindex=0><code>[Sep 25 22:41:17] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110
[Sep 25 22:41:17] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110)
[Sep 25 22:41:20] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110
[Sep 25 22:41:20] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110)
[Sep 25 22:41:33] kern kernel: ieee80211 phy0: brcmf_run_escan: error (-110)
[Sep 25 22:41:33] kern kernel: ieee80211 phy0: brcmf_cfg80211_scan: scan error (-110)
[Sep 25 22:41:36] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110
[Sep 25 22:41:36] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110)
[Sep 25 22:41:38] kern kernel: ieee80211 phy0: brcmf_proto_bcdc_query_dcmd: brcmf_proto_bcdc_msg failed w/status -110
[Sep 25 22:41:38] kern kernel: ieee80211 phy0: brcmf_cfg80211_get_channel: chanspec failed (-110)
</code></pre><p>I don&rsquo;t even know where to start with debugging this.</p><p>When I tried <code>NetworkManager</code>, it&rsquo;d constantly say <code>Connection activation failed: (7) Secrets were required, but not provided</code> even though my password was correct. I thought there were no secrets between me and my Nokia Beacon 1, but I suppose it begs to differ. I tried every fix I could find regarding this issue. I even tried changing the channels that my network used to match my iPhone hotspot in some kind of desperate last-ditch attempt to make things right.</p><p>(For checkling logs from these services, I used <code>logread</code>)</p><p>Despite all my half-baked attempts to fix this problem, my phone still has only ever connected on one network &ndash; my iPhone hotspot. Some kind of strange, forbidden electronic monogamy between my Samsung Galaxy and iPhone. I declare them husband and WiFi.</p><p><img loading=lazy src=https://res.cloudinary.com/dezwnhp01/image/upload/v1727370167/pmOS/photo_1_2024-09-27_01-02-37.jpg alt="Samsung Galaxy S2 running postmarketOS displaying that it is connected to a wifi network called &amp;ldquo;unemployable pigeon&amp;rdquo;"></p><p>My WiFi doesn&rsquo;t work because there are ghosts in the machine and love in the air.</p><h1 id=power-struggle-it-could-be-the-battery-or-perhaps-the-charging-port-or-both>Power struggle (it could be the battery, or perhaps the charging port, or both)<a hidden class=anchor aria-hidden=true href=#power-struggle-it-could-be-the-battery-or-perhaps-the-charging-port-or-both>#</a></h1><p>I started having problems where I&rsquo;d plug my charger in, then the phone would light up with an empty battery sign, and then go back to black. This would continue even as I left it plugged in for hours.</p><p>I got a new battery at a shop at Sim Lim Square (Unicell on the 2nd floor) which worked for about a week, before it started having this problem too. I decided to try measuring the voltage on the battery and it came up to about 2.6V after 5 hours of charging.</p><p>After leaving it overnight, I measured the voltage the next day and it came up to&mldr; 0.004V.</p><p><img loading=lazy src=https://res.cloudinary.com/dezwnhp01/image/upload/v1727374392/pmOS/photo_2024-09-27_02-12-56.jpg alt="Multimeter reading showing a samsung galaxy s2 battery measuring 0.004v"></p><p><em>We&rsquo;re totally back together</em></p><p>Unicell gave me a replacement as I brought it back to the store within 30 days, and they verified that it really was unbelievably drained with their own multimeter. This was nice, as I got a bit loopy and started wondering if my multimeter was also broken.</p><p><em>We&rsquo;re so over</em></p><p>The same problem appeared with the new battery. At this point, I feel like I&rsquo;ve tried all I can think of and can&rsquo;t seem to surmount the problems with powering this device and also getting it to connect to my home wifi (much less powering it with solar).</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://tomoe.asia>nondescryptid</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>